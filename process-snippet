#!/usr/bin/env bash

# Detect script directory (resolve symlinks) - portable version
if [ -n "${BASH_SOURCE:-}" ]; then
  SOURCE="${BASH_SOURCE[0]}"
else
  SOURCE="$0"
fi

# Resolve symlinks
while [ -L "$SOURCE" ]; do
  SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  case "$SOURCE" in
    /*) ;;
    *) SOURCE="$SCRIPT_DIR/$SOURCE" ;;
  esac
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
DPATH="${REALQUICK_HOME:-$SCRIPT_DIR}"
SNIPS_DIR="$DPATH/snips"

file_name=$1
shift

if [ -z "$file_name" ]; then
  echo "Error: No file name provided."
  exit 1
fi

snippet_path="$SNIPS_DIR/$file_name"

if [ ! -f "$snippet_path" ]; then
  echo "Error: File not found."
  exit 1
fi

snippet_text=$(cat "$snippet_path")

for i in 0 1 2 3 4 5 6 7 8 9
do
	case "$snippet_text" in
		*"~$i~"*)
			if [ -f "$DPATH/inps/$i" ]; then
				replacement=$(cat "$DPATH/inps/$i")
			else
				replacement=""
			fi
			snippet_text=$(echo "$snippet_text" | sed "s|~$i~|$replacement|g")
			;;
	esac
done

if [ "${XDG_SESSION_TYPE:-}" = "wayland" ]; then
  echo -n "$snippet_text" | wl-copy
else
  echo -n "$snippet_text" | xclip -selection clipboard 2>/dev/null || echo -n "$snippet_text" | xsel --clipboard
fi

#echo -n type $snippet_text | dotool 

# Add the snippet_text to the clipboard using copyq
#echo -n "$snippet_text" | copyq add -
#copyq select 0

#sleep 0.2
#xdotool type "$snippet_text"


